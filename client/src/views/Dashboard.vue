<template>
  <div v-if="authorized" class="main-dashboard w-full h-full">
    <div class="header flex justify-end pt-8 w-5/6 mx-auto">
      <!-- <router-link to="/" class="">
        <svg width="69" height="28" viewBox="0 0 69 28" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M2.59009 15.6934H11.9826L12.8997 12.3455H7.48166L9.75759 3.97567H5.78319L2.59009 15.6934ZM19.4145 15.9278C21.2998 15.9278 22.9983 15.4925 24.1193 14.3877C24.9515 13.5675 25.563 12.4292 25.9876 10.8724L27.873 3.97567H23.8305L22.1151 10.2698C21.8603 11.1737 21.6225 11.6257 21.2659 11.9772C20.9432 12.2953 20.4846 12.4627 19.992 12.4627C18.939 12.4627 18.3615 11.9605 18.3615 10.9896C18.3615 10.7218 18.4124 10.4037 18.4974 10.0689L20.1619 3.97567H16.1195L14.523 9.81781C14.3531 10.4539 14.2682 11.1068 14.2682 11.7094C14.2682 14.3543 16.0686 15.9278 19.4145 15.9278ZM26.8006 15.6934H30.741L32.3376 9.86803L35.157 15.6934H38.6898L41.8829 3.97567H37.9425L36.4139 9.56672L33.7133 3.97567H29.9937L26.8006 15.6934ZM47.7487 15.9445C50.2794 15.9445 52.0119 14.9234 53.2008 13.3834L50.4493 11.2407C49.8039 12.0274 49.0565 12.4627 48.1394 12.4627C47.0863 12.4627 46.2711 11.7429 46.2711 10.4539C46.2711 8.84691 47.426 7.2399 49.2094 7.2399C50.1096 7.2399 50.806 7.70861 51.0607 8.66277L54.6105 7.13947C54.118 5.06375 52.3006 3.72458 49.7359 3.72458C44.6066 3.72458 42.1098 7.60818 42.1098 10.8054C42.1098 13.9525 44.4197 15.9445 47.7487 15.9445ZM54.1954 15.6934H58.1698L59.3078 11.4918H62.9425L61.8045 15.6934H65.7789L68.9721 3.97567H64.9977L63.8597 8.11037H60.225L61.3629 3.97567H57.3885L54.1954 15.6934Z" fill="#F71140" />
          <path d="M0.152832 25.8941H2.11456L3.66865 20.1943L5.09536 23.9105H5.14631L8.63665 20.1566L7.08255 25.8941H9.06975L11.4646 17.1058H9.19714L5.8724 20.822L4.58582 17.1058H2.54766L0.152832 25.8941ZM17.199 26.0448C17.9973 26.0448 18.7234 25.8983 19.3773 25.6054C20.0397 25.3041 20.6044 24.9107 21.0715 24.4252C21.5471 23.9398 21.9122 23.3874 22.167 22.768C22.4303 22.1403 22.5619 21.5 22.5619 20.8471C22.5619 20.2947 22.4642 19.7842 22.2689 19.3155C22.0736 18.8384 21.7976 18.4241 21.4409 18.0725C21.0842 17.721 20.6554 17.449 20.1543 17.2565C19.6533 17.0556 19.097 16.9552 18.4856 16.9552C17.6873 16.9552 16.957 17.1058 16.2946 17.4071C15.6407 17.7001 15.0759 18.0893 14.6003 18.5747C14.1333 19.0602 13.7681 19.6168 13.5048 20.2445C13.2501 20.8639 13.1227 21.5 13.1227 22.1528C13.1227 22.7052 13.2203 23.22 13.4157 23.6971C13.611 24.1658 13.887 24.5759 14.2437 24.9274C14.6003 25.279 15.0292 25.5552 15.5303 25.756C16.0313 25.9485 16.5875 26.0448 17.199 26.0448ZM17.4283 24.262C17.0631 24.262 16.7362 24.2076 16.4474 24.0988C16.1672 23.99 15.9294 23.8352 15.7341 23.6343C15.5472 23.4334 15.4029 23.1991 15.301 22.9312C15.2075 22.655 15.1608 22.3537 15.1608 22.0273C15.1608 21.6506 15.233 21.2656 15.3774 20.8722C15.5303 20.4789 15.7383 20.1273 16.0016 19.8177C16.2733 19.4996 16.6003 19.2401 16.9824 19.0393C17.3646 18.8384 17.7892 18.7379 18.2563 18.7379C18.6215 18.7379 18.9442 18.7923 19.2244 18.9012C19.5131 19.01 19.7509 19.1648 19.9378 19.3657C20.1331 19.5666 20.2775 19.8051 20.3709 20.0813C20.4728 20.3491 20.5237 20.6463 20.5237 20.9727C20.5237 21.3493 20.4473 21.7343 20.2944 22.1277C20.1501 22.5211 19.942 22.8768 19.6703 23.1949C19.407 23.5046 19.0843 23.7598 18.7021 23.9607C18.32 24.1616 17.8954 24.262 17.4283 24.262ZM24.231 25.8941H26.1673L27.734 20.1315L30.4345 25.8941H32.1033L34.4981 17.1058H32.5619L31.0333 22.6927L28.4346 17.1058H26.6257L24.231 25.8941ZM35.4554 25.8941H42.1813L42.6526 24.1741H37.8629L38.3725 22.316H42.5125L42.9838 20.6212H38.8438L39.3278 18.8258H44.0411L44.5124 17.1058H37.8502L35.4554 25.8941ZM47.1371 25.8941H49.0988L50.0032 22.6048L54.882 17.1058H52.5127L49.4555 20.7467L48.4109 17.1058H46.2326L48.0797 22.429L47.1371 25.8941Z" fill="white" />
          <path fill-rule="evenodd" clip-rule="evenodd" d="M64.9417 22.6773C64.5425 24.8053 62.6498 26.4172 60.3749 26.4172C57.81 26.4172 55.7307 24.3679 55.7307 21.84C55.7307 19.312 57.81 17.2627 60.3749 17.2627C61.657 17.2627 62.8175 17.7746 63.658 18.6024C63.658 18.6024 62.6687 19.9421 64.283 20.6398C64.283 20.6398 63.658 21.8958 64.9417 22.6773Z" fill="#FFA800" />
          <path d="M60.0374 25.1243L60.8654 25.1239L60.8648 24.3549C61.9954 24.2522 62.7435 23.6633 62.743 22.706V22.6903C62.7422 21.7173 62.105 21.2704 60.8391 20.9808L60.8386 20.0706C61.1968 20.1567 61.579 20.3134 61.9057 20.5408L62.5577 19.489C62.08 19.1675 61.5304 18.9481 60.8776 18.8779L60.8773 18.4071L60.0493 18.4075L60.0496 18.8548C58.8315 18.9418 58.1473 19.5856 58.1478 20.5116V20.5273C58.1484 21.5002 58.8015 21.9314 60.0835 22.221L60.0841 23.1626C59.5902 23.0844 59.1125 22.8729 58.6027 22.5201L57.887 23.5641C58.4841 23.9874 59.2566 24.2616 60.0368 24.3397L60.0374 25.1243ZM60.0904 20.8478C59.6605 20.7304 59.5491 20.6128 59.5491 20.4087L59.5488 20.3931C59.5488 20.189 59.7001 20.032 60.0902 20.0004L60.0904 20.8478ZM60.8325 23.2093L60.8319 22.3461C61.2459 22.4636 61.3654 22.5812 61.3656 22.7931V22.8088C61.3656 23.0363 61.1987 23.1698 60.8325 23.2093Z" fill="white" />
        </svg>
      </router-link> -->
      <div class="relative">
        <span @click="optionToggled = !optionToggled"
              class="cursor-pointer flex items-center block py-1 px-5 rounded-full bg-lunchPink-600 text-lunchPurple-700 text-center font-black focus:bg-lunchPink-700 "
        >
          <svg class="mr-2" width="7" height="11" viewBox="0 0 7 11" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.223448 4.91581L4.54156 0.242268C4.84002 -0.080756 5.32263 -0.080756 5.61791 0.242268L6.33548 1.0189C6.63394 1.34192 6.63394 1.86426 6.33548 2.18385L3.27788 5.5L6.33866 8.81271C6.63712 9.13574 6.63712 9.65807 6.33866 9.97766L5.62109 10.7577C5.32263 11.0808 4.84002 11.0808 4.54474 10.7577L0.226623 6.08419C-0.0750098 5.76117 -0.0750097 5.23883 0.223448 4.91581Z" fill="#12012F" />
          </svg>
          {{ this.$store.state.currentUserName }}
        </span>
        <div v-if="optionToggled" class="flex items-center absolute top-0 mt-1 -ml-24">
          <svg @click="logout" class="mr-4" width="28" height="21" viewBox="0 0 28 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M27.6125 11.429L18.2787 20.6149C17.4453 21.4351 16.0008 20.861 16.0008 19.6854V14.4363H8.44486C7.70594 14.4363 7.11146 13.8512 7.11146 13.124V7.87486C7.11146 7.14763 7.70594 6.56257 8.44486 6.56257H16.0008V1.31344C16.0008 0.143327 17.4398 -0.436264 18.2787 0.383912L27.6125 9.56989C28.1292 10.0839 28.1292 10.915 27.6125 11.429ZM10.6672 20.3415V18.1544C10.6672 17.7935 10.3672 17.4983 10.0005 17.4983H5.3336C4.35022 17.4983 3.55573 16.7164 3.55573 15.7485V5.25029C3.55573 4.28248 4.35022 3.50058 5.3336 3.50058H10.0005C10.3672 3.50058 10.6672 3.20532 10.6672 2.84444V0.657304C10.6672 0.296426 10.3672 0.00116294 10.0005 0.00116294H5.3336C2.38901 0.00116294 0 2.35233 0 5.25029V15.7485C0 18.6465 2.38901 20.9977 5.3336 20.9977H10.0005C10.3672 20.9977 10.6672 20.7024 10.6672 20.3415Z" fill="#F71140" />
          </svg>
          <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21.5424 14.2691L23.6965 15.509C23.9425 15.6506 24.0567 15.9434 23.9724 16.2139C23.4129 18.0104 22.4576 19.6334 21.2081 20.9813C21.1146 21.0823 20.9895 21.1485 20.8533 21.1691C20.717 21.1898 20.5778 21.1636 20.4584 21.0949L18.306 19.8553C17.4004 20.629 16.3592 21.2293 15.2349 21.6259V24.1049C15.2349 24.2423 15.188 24.3757 15.1018 24.4831C15.0157 24.5904 14.8954 24.6653 14.7609 24.6955C12.994 25.0912 11.0964 25.1116 9.24035 24.6958C8.96285 24.6337 8.76507 24.3886 8.76507 24.105V21.6259C7.64074 21.2294 6.59956 20.6291 5.69395 19.8553L3.54151 21.0949C3.42215 21.1636 3.28293 21.1898 3.14669 21.1691C3.01046 21.1485 2.88531 21.0823 2.79181 20.9813C1.54242 19.6334 0.58705 18.0104 0.0275071 16.2139C-0.0567528 15.9434 0.0574302 15.6506 0.303437 15.509L2.45755 14.2691C2.24119 13.0996 2.24119 11.9005 2.45755 10.7309L0.303488 9.49104C0.0574808 9.34945 -0.0567023 9.05666 0.0275576 8.78615C0.5871 6.98968 1.54242 5.3667 2.79186 4.01872C2.88536 3.91779 3.01051 3.85156 3.14674 3.83091C3.28298 3.81027 3.4222 3.83643 3.54156 3.90511L5.694 5.14478C6.59963 4.37101 7.6408 3.77072 8.76512 3.37412V0.89514C8.76511 0.757653 8.81205 0.624261 8.89819 0.516913C8.98434 0.409566 9.10456 0.334658 9.23909 0.304516C11.006 -0.091148 12.9036 -0.111612 14.7597 0.304163C15.0371 0.366311 15.2349 0.611421 15.2349 0.895039V3.37407C16.3593 3.77064 17.4004 4.37094 18.306 5.14473L20.4585 3.90506C20.5778 3.83638 20.7171 3.81022 20.8533 3.83086C20.9895 3.85151 21.1147 3.91774 21.2082 4.01867C22.4576 5.36665 23.413 6.98963 23.9725 8.7861C24.0568 9.05656 23.9426 9.34935 23.6966 9.49098L21.5424 10.7309C21.7588 11.9004 21.7588 13.0996 21.5424 14.2691ZM16.0437 12.5C16.0437 10.2766 14.2297 8.46775 12 8.46775C9.77032 8.46775 7.95633 10.2766 7.95633 12.5C7.95633 14.7234 9.77032 16.5322 12 16.5322C14.2297 16.5322 16.0437 14.7234 16.0437 12.5Z" fill="#F71140" />
          </svg>
        </div>
      </div>
    </div>
    <!-- <user-settings></user-settings> -->
    <div class="dashboard w-5/6 mx-auto h-full">
      <current-budget></current-budget>
      <budget-historic></budget-historic>
    </div>
    
    
  </div>
</template>
<script>
import UserSettings from '../components/UserSettings.vue'
import CurrentBudget from '../components/CurrentBudget.vue'
import BudgetHistoric from '../components/BudgetHistoric.vue'

export default {
  components: {
    UserSettings,
    CurrentBudget,
    BudgetHistoric
  },
  data() {
    return {
      authorized: false,
      optionToggled: false
    }
  },
  beforeCreate() {
    this.$axios.get('/user')
      .then(res => {
        console.log(res)
        this.$store.commit('setName', res.data[0])
        this.$store.commit('setEmail', res.data[1])
        this.$store.commit('setCurrency', res.data[2])
        this.authorized = true
      })
      .catch()
  },
  methods: {
    logout() {
      this.$axios.post('/logout')
        .then(res => {
          console.log(res)
          res.status === 202 ? this.authorized = false : ''
          this.$cookies.isKey('refresh_token') ? this.$cookies.remove('refresh_token') : null
          this.$cookies.isKey('token') ? this.$cookies.remove('token') : null
          this.$router.push('/login')
        })
        .catch(err => {
          console.log(err)
        })
    }
  }
}
</script>